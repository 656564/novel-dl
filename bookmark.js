javascript:(async()=>{async function s(e){var t,o=await fetch(e);return o.ok?(t=await o.text(),(t=(new DOMParser).parseFromString(t,"text/html").querySelector("#novel_content"))?function(o){return Object.entries({"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'","&#039;":"'","&nbsp;":" ","&ndash;":"–","&mdash;":"—","&lsquo;":"‘","&rsquo;":"’","&ldquo;":"“","&rdquo;":"”"}).forEach(([e,t])=>{e=new RegExp(e,"g");o=o.replace(e,t)}),o}(t.innerHTML.replace(/<div>/g,"").replace(/<\/div>/g,"").replace(/<p>/g,"\n").replace(/<\/p>/g,"\n").replace(/<br\s*[/]?>/g,"\n").replace(/<[^>]*>/g,"")):(console.error("Failed to find '#novel_content' on the page: "+e),null)):(console.error(`Failed to fetch content from ${e}. Status: `+o.status),null)}async function e(t,o){let n=t+`
Downloaded with novel-dl,
https://github.com/yeorinhieut/novel-dl

`;var e=document.querySelector("#at-main > div.view-wrap > section > article > div.view-title > div > div > div.col-sm-8 > div:nth-child(3)");if(e){var l=document.createElement("div"),i=(l.style.textAlign="center",e.appendChild(l),document.createElement("div")),r=(i.style.width="0%",i.style.height="15px",i.style.backgroundColor="#4CAF50",i.style.marginTop="10px",i.style.borderRadius="3px",l.appendChild(i),document.createElement("div"));r.style.marginTop="5px",l.appendChild(r);for(let e=o.length-1;0<=e;e--){var a,d=o[e];d.startsWith("https://booktoki")?(console.log(`Downloading: ${t} - Episode ${o.length-e}/`+o.length),(a=await s(d))?(n+=a,a=(o.length-e)/o.length*100,i.style.width=a+"%",r.textContent=`Downloading... ${a.toFixed(2)}% - Episode ${o.length-e}/`+o.length,await(t=>new Promise(e=>setTimeout(e,t)))(1e3)):console.error("Failed to fetch content for episode: "+d)):console.log("Skipping invalid episode link: "+d)}l.parentNode.removeChild(l);e=new Blob([n],{type:"text/plain"}),l=document.createElement("a");l.href=URL.createObjectURL(e),l.download=t+".txt",l.click()}else console.error("Failed to find the target element for the progress bar.")}var t,o;window.location.href.startsWith("https://booktoki")?(t=(t=document.evaluate('//*[@id="content_wrapper"]/div[1]/span',document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)?t.textContent.trim():null)?(console.log("Task Appended: Preparing to download "+t),0===(o=function(){const t=[];return document.querySelectorAll(".item-subject").forEach(e=>{e=e.getAttribute("href");t.push(e)}),t}()).length?console.log("No episode links found."):e(t,o)):console.log("Failed to extract the novel title."):console.log("This script should be run on the novel episode list page.")})();